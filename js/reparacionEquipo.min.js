$(document).on("ready",inicio);function Defecto(a){a.preventDefault();}var dialogos={autoOpen:false,resizable:false,width:760,height:300,modal:true,};function fn_dar_eliminar(a){$("a.elimina").click(function(){id=$(this).parents("tr").find("td").eq(0).html();
$(this).parents("tr").fadeOut("normal",function(){$(this).remove();Rtotal();});});}function agregarR(){$("#tblRepracion tbody").append("<tr><td align=center>"+$("#selectRepa").val()+"</td><td align=center>"+$("#selectRepa option:selected").text()+"</td><td align=center>$ "+$("#selectRepa").find("option:selected").data("foo")+"</td><td align=center> <a class='elimina'><img src='../imagenes/delete.png' onclick='return fn_dar_eliminar(event)' title='Borrar fila'/></td></tr>");
Rtotal();}function inicio(){$(window).bind("resize",function(){jQuery("#list").setGridWidth($("#grilla").width()-10);}).trigger("resize");$("#btnGuardar").on("click",guardarTrabajo);
$("#agreDa").on("click",agregarR);$("#tRepraciones").dialog(dialogos);$("#btnAgregar").on("click",function(){$("#tRepraciones").dialog("open");});$("#formRepara").css("display","none");
$("#botones a").on("click",Defecto);$("#tRepraciones a").on("click",Defecto);$("#btnBuscar").on("click",function(){$("#grilla").css("display","block");
$("#formRepara").css("display","none");limpiarDatos();});$("#btnAgregar").button({icons:{primary:"ui-icon-wrench"},});$("#btnGuardar").button({icons:{primary:"ui-icon-disk"},});
$("#agreDa").button({icons:{primary:"ui-icon-wrench"},});$("#btnModificar").button({icons:{primary:"ui-icon-pencil"},});$("#btnBuscar").button({icons:{primary:"ui-icon-search"},});
jQuery("#list").jqGrid({url:"../xml/xmlreparacionEquipo.php",datatype:"xml",colNames:["Nro Registro","Nombres Cliente","Id Cliente","Fecha Ingreso","Fecha Salida","Nro. de Serie","Modelo","Id categoria","Tipo de Equipo","Id Marca","Marca","Id color","Nombre Color","Accesosios","Observaciones","Id Usuario","Registrado por","Id estado","Estado"],colModel:[{name:"txtRegistro",index:"txtRegistro",editable:true,align:"center",width:"100",search:false,frozen:true},{name:"txtCliente",index:"txtCliente",editable:true,align:"center",width:"150",search:true,frozen:true},{name:"txtClienteId",index:"txtClienteId",search:false,editable:false,hidden:true,editrules:{edithidden:false},align:"center",frozen:true,width:80},{name:"txtIngreso",index:"txtIngreso",editable:true,align:"center",width:"150",search:false,frozen:true},{name:"txtSalida",index:"txtSalida",editable:true,align:"center",width:"150",search:false,frozen:false},{name:"txtSerie",index:"txtSerie",editable:true,align:"center",width:"180",search:true,frozen:false},{name:"txtModelo",index:"txtModelo",editable:true,align:"center",width:"180",search:false,frozen:false},{name:"txtTipoEquipoId",index:"txtTipoEquipoId",search:false,editable:false,hidden:true,editrules:{edithidden:false},align:"center",frozen:true,width:80},{name:"txtTipoEquipo",index:"txtTipoEquipo",editable:true,align:"center",width:"150",search:true,frozen:false},{name:"txtMarcaId",index:"txtMarcaId",search:false,editable:false,hidden:true,editrules:{edithidden:false},align:"center",frozen:true,width:80},{name:"txtMarca",index:"txtMarca",editable:true,align:"center",width:"150",search:true,frozen:false},{name:"txtColorId",index:"txtColorId",search:false,editable:false,hidden:true,editrules:{edithidden:false},align:"center",frozen:true,width:80},{name:"txtColor",index:"txtColor",editable:true,align:"center",width:"150",search:true,frozen:false},{name:"txtAccesorios",index:"txtAccesorios",editable:true,align:"center",width:"150",search:false,frozen:false},{name:"txtObservaciones",index:"txtObservaciones",editable:true,align:"center",width:"150",search:false,frozen:false},{name:"id_user",index:"id_user",search:false,editable:false,hidden:true,editrules:{edithidden:false},align:"center",frozen:true,width:80},{name:"nombre_user",index:"nombre_user",editable:true,align:"center",width:"150",search:false,frozen:false},{name:"id_estado",index:"id_estado",search:false,editable:false,hidden:true,editrules:{edithidden:false},align:"center",frozen:true,width:80},{name:"Estado",index:"Estado",editable:true,align:"center",width:"150",search:true,frozen:false},],rowNum:20,rowList:[20,40,60],height:350,pager:jQuery("#pager"),sortname:"id_registro",shrinkToFit:false,sortorder:"asc",caption:"Lista Equipos",viewrecords:true,gridview:true,}).jqGrid("navGrid","#pager",{add:false,edit:false,del:false,refresh:true,search:true,view:true,},{recreateForm:true,closeAfterEdit:true,checkOnUpdate:true,reloadAfterSubmit:true,closeOnEscape:true,},{reloadAfterSubmit:true,closeAfterAdd:true,checkOnUpdate:true,reloadAfterSubmit:true,closeOnEscape:true,bottominfo:"Todos los campos son obligatorios son obligatorios"},{width:300,closeOnEscape:true},{sopt:["eq","bw"],multipleSearch:false,overlay:false},{closeOnEscape:true,width:400,},{closeOnEscape:true,});
jQuery("#list").jqGrid("navButtonAdd","#pager",{caption:"Modificar",onClickButton:function(){var b=jQuery("#list").jqGrid("getGridParam","selrow");if(b){var a=jQuery("#list").jqGrid("getRowData",b);
jQuery("#list").jqGrid("GridToForm",b,"#formReparaEquipo");$.ajax({type:"POST",url:"../procesos/cambioEstado.php",data:"id_registro="+$("#txtRegistro").val(),success:function(c){val=c;
}});$("#formRepara").css("display","block");$("#grilla").css("display","none");}else{alert("Seleccione un fila");}}});jQuery("#list").jqGrid("navButtonAdd","#pager",{caption:"PDF",onClickButton:function(){var b=jQuery("#list").jqGrid("getGridParam","selrow");
if(b){var a=jQuery("#list").jqGrid("getRowData",b);window.open("../reportes/reportes/reporteRegistro.php?id="+a.txtRegistro);}else{alert("Seleccione un fila");
}}});jQuery("#list").jqGrid("setFrozenColumns");jQuery("#list").setGridWidth($("#grilla").width()-10);}function limpiarDatos(){$("#txtRegistro").val("");
$("#txtCliente").val("");$("#txtClienteId").val("");$("#txtIngreso").val("");$("#txtMante").val("$ 0");$("#txtTipoEquipo").val("");$("#txtTipoEquipoId").val("");
$("#txtModelo").val("");$("#txtSerie").val("");$("#txtColor").val("");$("#txtColorId").val("");$("#txtMarca").val("");$("#txtMarcaId").val("");$("#resp").val("");
$("#txtObservaciones").val("");$("#txtAccesorios").val("");$("#tblRepracion tbody tr").remove();}function Rtotal(){cont=0;var a;var b=0;$("#tblRepracion tbody tr").each(function(c){$(this).children("td").each(function(d){switch(d){case 2:a=$(this).text().substr(2);
b=b+parseFloat(a);break;}});cont++;});$("#txtMante").val("");$("#txtMante").val("$ "+b);}function guardarTrabajo(){var b=new Array();var a=new Array();
cont=0;$("#tRepraciones tbody tr").each(function(c){$(this).children("td").each(function(d){switch(d){case 1:b[cont]=$(this).text();break;case 2:a[cont]=$(this).text().substr(2);
break;}});cont++;});if($("#txtMante").val().substr(2)>0){$.ajax({type:"POST",url:"../procesos/reparacionEquipos.php",data:"id_registro="+$("#txtRegistro").val()+"&total_reparaciones="+$("#txtMante").val().substr(2)+"&vector1="+b+"&vector2="+a+"&tipo=g",success:function(c){val=c;
if(val==1){alert("Datos Guardados");location.reload();}if(val==0){alert("Error.. durante el proceso");}}});}else{alert("Antes de proceder ingrese las reparaciones realizadas");
$("#tRepraciones").dialog("open");}}