$(document).on("ready",inicio);function Defecto(a){a.preventDefault();}function fn_dar_eliminar(a){$("a.elimina").click(function(){id=$(this).parents("tr").find("td").eq(0).html();
$(this).parents("tr").fadeOut("normal",function(){$(this).remove();Rtotal();});});}function inicio(){$(window).bind("resize",function(){jQuery("#list").setGridWidth($("#tablaEn").width()-10);
}).trigger("resize");$("#tablaEn").css("display","block");$("#entregaP").css("display","none");$("#botones a").on("click",Defecto);$("#txtDesc").spinner({min:0,step:1,});
$("#btnGuardar").button({icons:{primary:"ui-icon-disk"},});$("#btnBuscar").button({icons:{primary:"ui-icon-search"},});jQuery("#list").jqGrid({url:"../xml/xmlEntregaEquipo.php",datatype:"xml",colNames:["Nro Registro","Nombres Cliente","Id Cliente","Fecha Ingreso","Fecha Salida","Id estado","Estado","Técnico a cargo","Nro. de Serie","Modelo","Id categoria","Tipo de Equipo","Id Marca","Marca","Id color","Nombre Color","Accesosios","Observaciones","Id Usuario","Registrado por"],colModel:[{name:"txtRegistro",index:"txtRegistro",editable:true,align:"center",width:"100",search:false,frozen:true},{name:"txtCliente",index:"txtCliente",editable:true,align:"center",width:"180",search:true,frozen:true},{name:"txtClienteId",index:"txtClienteId",search:false,editable:false,hidden:true,editrules:{edithidden:false},align:"center",frozen:true,width:80},{name:"txtIngreso",index:"txtIngreso",editable:true,align:"center",width:"160",search:false,frozen:true},{name:"txtSalida",index:"txtSalida",editable:true,align:"center",width:"100",search:false,frozen:false},{name:"id_estado",index:"id_estado",search:false,editable:false,hidden:true,editrules:{edithidden:false},align:"center",frozen:false,width:80},{name:"Estado",index:"Estado",editable:true,align:"center",width:"160",search:true,frozen:false},{name:"tecnico",index:"tecnico",editable:true,align:"center",width:"160",search:true,frozen:false},{name:"txtSerie",index:"txtSerie",editable:true,align:"center",width:"200",search:true,frozen:false},{name:"txtModelo",index:"txtModelo",editable:true,align:"center",width:"200",search:false,frozen:false},{name:"txtTipoEquipoId",index:"txtTipoEquipoId",search:false,editable:false,hidden:true,editrules:{edithidden:false},align:"center",frozen:false,width:80},{name:"txtTipoEquipo",index:"txtTipoEquipo",editable:true,align:"center",width:"330",search:true,frozen:false},{name:"txtMarcaId",index:"txtMarcaId",search:false,editable:false,hidden:true,editrules:{edithidden:false},align:"center",frozen:false,width:80},{name:"txtMarca",index:"txtMarca",editable:true,align:"center",width:"330",search:true,frozen:false},{name:"txtColorId",index:"txtColorId",search:false,editable:false,hidden:true,editrules:{edithidden:false},align:"center",frozen:false,width:80},{name:"txtColor",index:"txtColor",editable:true,align:"center",width:"330",search:true,frozen:false},{name:"txtAccesorios",index:"txtAccesorios",editable:true,align:"center",width:"330",search:false,frozen:false},{name:"txtObservaciones",index:"txtObservaciones",editable:true,align:"center",width:"330",search:false,frozen:false},{name:"id_user",index:"id_user",search:false,editable:false,hidden:true,editrules:{edithidden:false},align:"center",frozen:false,width:80},{name:"nombre_user",index:"nombre_user",editable:true,align:"center",width:"330",search:false,frozen:false},],rowNum:20,rowList:[20,40,60],height:400,pager:jQuery("#pager"),sortname:"id_registro",shrinkToFit:false,forceFit:true,sortorder:"asc",caption:"Lista Entregas",viewrecords:true,gridview:true,}).jqGrid("navGrid","#pager",{add:false,edit:false,del:false,refresh:true,search:true,view:true,},{recreateForm:true,closeAfterEdit:true,checkOnUpdate:true,reloadAfterSubmit:true,closeOnEscape:true,},{reloadAfterSubmit:true,closeAfterAdd:true,checkOnUpdate:true,reloadAfterSubmit:true,closeOnEscape:true,bottominfo:"Todos los campos son obligatorios son obligatorios"},{width:300,closeOnEscape:true},{sopt:["eq","bw"],multipleSearch:false,overlay:false},{closeOnEscape:true,width:400,},{closeOnEscape:true,});
jQuery("#list").jqGrid("navButtonAdd","#pager",{caption:"Entregar Producto",onClickButton:function(){var b=jQuery("#list").jqGrid("getGridParam","selrow");
if(b){var a=jQuery("#list").jqGrid("getRowData",b);if(a.id_estado==1){jQuery("#list").jqGrid("GridToForm",b,"#formEntrega");$("#entregaP").css("display","block");
$("#tablaEn").css("display","none");$.ajax({type:"POST",dataType:"json",url:"../procesos/cargaReparaciones.php",data:"id_registro="+$("#txtRegistro").val(),success:function(c){var d=c;
$("#resp").val(d[3]);$("#txtTotal").val("$ "+d[4]);$("#txtTotal1").val(d[4]);for(i=5;i<d.length;i=i+2){$("#tblRepracion tbody").append("<tr><td align=center>1</td><td align=center>"+d[i]+"</td><td align=center>$ "+d[i+1]+"</td><td align=center>$ "+d[i+1]+"</td><td align=center> <a class='elimina'><img src='../imagenes/delete.png' onclick='return fn_dar_eliminar(event)' title='Borrar fila'/></td></tr>");
}$("#txtDesc").spinner({max:d[4],min:0,});}});}if(a.id_estado==0){alert("El producto aún no esta pendiente para su reparación");}if(a.id_estado==2){alert("El producto ya fue entregado");
}if(a.id_estado==3){alert("El producto esta en estado de reparación a cargo del técnico: "+a.tecnico);}}else{alert("Seleccione un fila");}}});$("#list").jqGrid("setFrozenColumns");
jQuery("#list").setGridWidth($("#tablaEn").width()-10);$("#botones a").on("click",Defecto);$(".ui-spinner-button").click(function(){$(this).siblings("input").change();
});$(".ui-spinner-up").click(function(){var b=parseFloat($("#txtTotal1").val())-parseFloat($("#txtDesc").val());$("#txtTotal").val("$ "+b);});$(".ui-spinner-down").click(function(){var b=parseFloat($("#txtTotal1").val())+parseFloat($("#txtDesc").val());
$("#txtTotal").val("$ "+b);});$("#btnBuscar").on("click",buscarReparacion);$("#btnGuardar").on("click",guardarReparacion);}function Rtotal(){cont=0;var a;
var b=0;$("#tblRepracion tbody tr").each(function(c){$(this).children("td").each(function(d){switch(d){case 3:a=$(this).text().substr(2);b=b+parseFloat(a);
break;}});cont++;});$("#txtTotal").val("");$("#txtTotal").val("$ "+b);$("#txtTotal1").val("");$("#txtTotal1").val(b);}function buscarReparacion(){$("#tablaEn").css("display","block");
$("#entregaP").css("display","none");limpiarDatos();}function guardarReparacion(){cont=0;var c=new Array();var b=new Array();$("#tblRepracion tbody tr").each(function(d){$(this).children("td").each(function(e){switch(e){case 1:c[cont]=$(this).text();
break;case 2:b[cont]=$(this).text().substr(2);break;}});cont++;});var a=new Date().toISOString().slice(0,10);$.ajax({type:"POST",url:"../procesos/procesosEntrega.php",data:"id_registro="+$("#txtRegistro").val()+"&total="+$("#txtTotal").val()+"&descuento="+$("#txtDesc").val()+"&hoy="+a,success:function(d){var e=d;
alert("Datos Modificados");window.open("../reportes/reportes/reporteEntrega.php?id="+c+"&val="+b+"&desc="+$("#txtDesc").val()+"&total="+$("#txtTotal").val().substr(2)+"&id_registro="+$("#txtRegistro").val()+"&hoy="+a);
limpiarDatos();$("#tablaEn").css("display","block");$("#entregaP").css("display","none");}});}function limpiarDatos(){$("#txtRegistro").val("");$("#txtCliente").val("");
$("#txtClienteId").val("");$("#txtIngreso").val("");$("#txtTotal").val("$ 0");$("#txtTotal1").val("");$("#txtTipoEquipo").val("");$("#txtTipoEquipoId").val("");
$("#txtModelo").val("");$("#txtSerie").val("");$("#txtColor").val("");$("#txtColorId").val("");$("#txtMarca").val("");$("#txtMarcaId").val("");$("#resp").val("");
$("txtObservaciones").val("");$("txtAccesorios").val("");$("#tblRepracion tbody tr").remove();}